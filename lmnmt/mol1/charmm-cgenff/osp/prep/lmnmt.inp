* CHARMM input file for Multi-Site lambda-dynamics
* generated by py_prep (JZV 02/2019) for ALF (RLH 01/2019)
* edited: Parveen Gartan, 27 June 2022
*
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!  Lambda Dynamics 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

set fnex = 5.5 
set builddir = prep
set box = 92.1673522
set temp = 298.15

! perturbation variables
set nsites = 1 
set nsubs1 = 2 
set nblocks = 2 

bomblev -2

!! Read in toppar stream file
stream @builddir/toppar.str

stream @builddir/5ag5_cof_rg.str

stream @builddir/6.str
stream @builddir/6r.str

read psf card name @builddir/5ag5_prot-6-neutralized.psf
read coor card name @builddir/5ag5_prot-6-prod-oriented.crd

read psf card name @builddir/6r.psf append
read coor card name @builddir/6r.crd append 

!! Read in LonePair sites (if applicable)
stream @builddir/lpsites.inp

!! Define MSLD substituent selections
define site1_sub1 select resname XRAY end
define site1_sub2 select resname REVR end

!auto angle dihe  !! do not call after deleting sub-sub terms or loading in water
bomblev -1

! delete angles and dihedrals between alchem groups
set ii = 1
label deletesiteloop
if @ii .le. @nsites then

   set jj = 1
   label delete1loop
   if @jj .le. @nsubs@@ii then

      calc kk = @jj + 1
      label delete2loop
      if @kk .le. @nsubs@@ii then

         dele connectivity sele ( site@{ii}_sub@@jj ) show end sele ( site@{ii}_sub@@kk ) show end
         calc kk = @kk + 1
         goto delete2loop
      endif

      calc jj = @jj + 1
      goto delete1loop
   endif

   calc ii = @ii + 1
   goto deletesiteloop
endif

!! ! System specific deletion (linear groups)
!! dele dihe sele (atom LIG 1 ATOMNAME) show end

!! Load solvent

!! Load ions

print coor sele .not. init end

bomblev 0

crystal define cubic @box @box @box 90. 90. 90.
crystal build cutoff 14 nope 0
image byres xcen 0 ycen 0 zcen 0 sele resn tip3 .or. resn pot .or. resn cla end
image byseg xcen 0 ycen 0 zcen 0 sele .not. ( resn tip3 .or. resn pot .or. resn cla ) end

scalar charge stat sele all end

!! Copy main coords into comp set
cons harm clear
coor copy comp



